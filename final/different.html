<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Find the Different Color Game</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background-color: #ffffff; /* 배경색을 흰색으로 설정 */
    }
    #container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
    }
    .color-box {
        width: 50px;
        height: 50px;
        margin: 5px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.3s ease-in-out;
    }
    .color-box:hover {
        border-color: black;
    }
    #level-text {
        font-size: 24px;
        font-weight: bold;
        margin-top: 20px;
    }
    #clear-text {
        font-size: 36px;
        font-weight: bold;
        margin-top: 50px;
        color: green;
    }
    #fail-text {
        font-size: 36px;
        font-weight: bold;
        margin-top: 50px;
        color: red;
    }
    #restart-button {
        position: fixed;
        top: 10px;
        left: 10px;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        display: none; /* 초기에는 숨김 */
    }
    #start-button {
        padding: 10px 20px;
        background-color: #2196F3;
        color: white;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        margin-top: 20px;
    }
</style>
</head>
<body>
<h1>Find the Different Color</h1>
<div id="level-text">Click Start to Play!</div>
<div id="container"></div>
<button id="restart-button" onclick="resetGame()">Restart</button>
<button id="start-button" onclick="startGame()">Start</button>

<script>
let level = 1;
let correctCount = 0;
let colors = [];

// Function to start the game
function startGame() {
    level = 1;
    correctCount = 0;
    colors = generateColors(level);
    updateLevelText();
    renderColorBoxes();
    document.getElementById('start-button').style.display = 'none';
}

// Function to render color boxes
function renderColorBoxes() {
    let container = document.getElementById('container');
    container.innerHTML = ''; // Clear current grid
    colors.forEach((color, index) => {
        let box = document.createElement('div');
        box.className = 'color-box';
        if (index === 48) {
            box.dataset.correct = 'true';
        }
        box.style.backgroundColor = color;
        box.addEventListener('click', function() {
            if (box.dataset.correct === 'true') {
                box.style.borderColor = 'green';
                correctCount++;
                if (correctCount === 3) {
                    if (level < 5) {
                        level++;
                        updateLevelText();
                        resetGame();
                    } else {
                        showClearMessage();
                    }
                }
            } else {
                box.style.borderColor = 'red';
                showFailMessage();
            }
        });
        container.appendChild(box);
    });
}

// Function to generate colors for the grid
function generateColors(level) {
    let colors = [];
    let baseColor = generateRandomColor();
    let subtleDifference = generateSubtleDifference(baseColor, level);
    for (let i = 0; i < 49; i++) {
        if (i === 48) {
            colors.push(subtleDifference);
        } else {
            colors.push(generateSimilarColor(subtleDifference, level));
        }
    }
    return colors;
}

// Function to generate a subtle color difference
function generateSubtleDifference(baseColor, level) {
    let hsl = rgbToHsl(baseColor.r, baseColor.g, baseColor.b);
    let h = hsl.h;
    let s = hsl.s;
    let l = hsl.l;
    
    let newL = clamp(l + level * 5, 0, 100); // Increase lightness for subtle difference
    let newColor = hslToRgb(h, s, newL);
    return `rgb(${newColor.r}, ${newColor.g}, ${newColor.b})`;
}

// Function to generate a similar color based on base color and level
function generateSimilarColor(baseColor, level) {
    let hsl = rgbToHsl(baseColor.r, baseColor.g, baseColor.b);
    let h = hsl.h;
    let s = hsl.s;
    let l = hsl.l;
    
    let newS = clamp(s - level * 5, 0, 100); // Decrease saturation for similar colors
    let newColor = hslToRgb(h, newS, l);
    return `rgb(${newColor.r}, ${newColor.g}, ${newColor.b})`;
}

// Function to clamp color values between 0 and 255
function clamp(color, min, max) {
    return Math.min(max, Math.max(min, color));
}

// Function to convert RGB to HSL
function rgbToHsl(r, g, b) {
    r /= 255;
    g /= 255;
    b /= 255;
    let max = Math.max(r, g, b), min = Math.min(r, g, b);
    let h, s, l = (max + min) / 2;

    if (max === min) {
        h = s = 0; // achromatic
    } else {
        let d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
    }

    return { h: h, s: s * 100, l: l * 100 };
}

// Function to convert HSL to RGB
function hslToRgb(h, s, l) {
    let r, g, b;
    h /= 360;
    s /= 100;
    l /= 100;

    if (s === 0) {
        r = g = b = l; // achromatic
    } else {
        let hue2rgb = function hue2rgb(p, q, t) {
            if (t < 0) t += 1;
            if (t > 1) t -= 1;
            if (t < 1 / 6) return p + (q - p) * 6 * t;
            if (t < 1 / 2) return q;
            if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
            return p;
        };
        let q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        let p = 2 * l - q;
        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
    }

    return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
}

// Function to update level text
function updateLevelText() {
    document.getElementById('level-text').textContent = `Level ${level}`;
}

// Function to show clear message and restart option
function showClearMessage() {
    let clearText = document.createElement('div');
    clearText.id = 'clear-text';
    clearText.textContent = 'Clear!';
    document.body.appendChild(clearText);
    document.getElementById('restart-button').style.display = 'block';
}

// Function to show fail message and restart option
function showFailMessage() {
    let failText = document.createElement('div');
    failText.id = 'fail-text';
    failText.textContent = 'Fail!';
    document.body.appendChild(failText);
    setTimeout(() => {
        resetGame();
    }, 1000);
}

// Function to reset the game
function resetGame() {
    correctCount = 0;
    colors = generateColors(level);
    renderColorBoxes();
    document.getElementById('level-text').textContent = `Level ${level}`;
    if (document.getElementById('clear-text')) {
        document.getElementById('clear-text').remove();
    }
    if (document.getElementById('fail-text')) {
        document.getElementById('fail-text').remove();
    }
    document.getElementById('restart-button').style.display = 'none';
}
</script>
</body>
</html>
